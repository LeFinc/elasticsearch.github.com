---
layout: guide
title: API
cat: guide
sidebar: reference_api
---
<div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="cascading"></a>Cascading support</h2></div></div></div><div class="toc"><dl><dt><span class="chapter"><a href="arch.html">Architecture</a></span></dt><dt><span class="chapter"><a href="configuration.html">Configuration</a></span></dt><dt><span class="chapter"><a href="configuration-runtime.html">Hadoop runtime options</a></span></dt><dt><span class="chapter"><a href="mapreduce.html">Map/Reduce integration</a></span></dt><dt><span class="chapter"><a href="cascading.html">Cascading support</a></span></dt><dt><span class="chapter"><a href="hive.html">Apache Hive integration</a></span></dt><dt><span class="chapter"><a href="pig.html">Apache Pig support</a></span></dt><dt><span class="chapter"><a href="mapping.html">Mapping and Types</a></span></dt></dl></div><div class="blockquote"><table border="0" class="blockquote" summary="Block quote"><tr><td width="10%" valign="top"> </td><td width="80%" valign="top"><p><a class="ulink" href="http://www.cascading.org/" target="_top">Cascading</a> is a data processing API and processing query planner used for defining, sharing, and executing data-processing workflows on a single computing node or distributed computing cluster.</p></td><td width="10%" valign="top"> </td></tr><tr><td width="10%" valign="top"> </td><td colspan="2" align="right" valign="top">--<span class="attribution">
Cascading website
</span></td></tr></table></div><p>Cascading abstracting the Map/Reduce API and focusing on <a class="ulink" href="http://docs.cascading.org/cascading/2.1/userguide/htmlch03.html" target="_top">data processing</a>
in terms of <span class="emphasis"><em>tuples</em></span> <a class="ulink" href="http://docs.cascading.org/cascading/2.1/userguide/htmlch03s08.html" target="_top"><span class="emphasis"><em>flowing</em></span></a> through <a class="ulink" href="http://docs.cascading.org/cascading/2.1/userguide/htmlch03s02.html" target="_top">pipes</a> between <a class="ulink" href="http://docs.cascading.org/cascading/2.1/userguide/htmlch03s05.html" target="_top"><span class="emphasis"><em>taps</em></span></a>,
from input (called <code class="literal">SourceTap</code>) to output (named <code class="literal">SinkTap</code>). As the data flows, various operations are applied to the tuple; the whole system being transformed to Map/Reduce operations at runtime.
With elasticsearch-hadoop, Elasticsearch can be plugged into Cascading flows as a <code class="literal">SourceTap</code> or <code class="literal">SinkTap</code> through <code class="literal">ESTap</code>.</p><div class="sidebar"><div class="titlepage"></div><p><strong>Local or Hadoop mode? </strong>Cascading supports two <span class="emphasis"><em>execution</em></span> modes or <a class="ulink" href="http://docs.cascading.org/cascading/2.1/userguide/htmlch03s04.html" target="_top">platforms</a>:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
Local
</span></dt><dd>
for unit testing and quick POCs. Everything runs only on the local machine and file-system.
</dd><dt><span class="term">
Hadoop
</span></dt><dd>
production mode - connects to a proper Hadoop cluster (as oppose to the <span class="emphasis"><em>local</em></span> mode which is running just on the local machine).
</dd></dl></div><p>elasticsearch-hadoop supports <span class="strong"><strong>both</strong></span> platforms automatically. One does not have to choose between different classes, <code class="literal">EsTap</code> can be used as both <code class="literal">sink</code> or <code class="literal">source</code>, in both modes transparently.</p></div><h3><a id="_installation_2"></a>Installation</h3><p>Just like other libraries, elasticsearch-hadoop needs to be available in the jar classpath (either by being manually deployed in the cluster or shipped along with the Hadoop job).</p><h3><a id="_configuration"></a>Configuration</h3><p>Cascading is configured through a <code class="literal">Map&lt;Object, Object&gt;</code>, typically a <code class="literal">Properties</code> object which indicates the various Cascading settings and also the application jar:</p><pre class="programlisting prettyprint lang-java">Properties props = new Properties();
AppProps.setApplicationJarClass(props, Main.class);
FlowConnector flow = new HadoopFlowConnector(props);</pre><p>elasticsearch-hadoop options can be specified in the same way, these being picked up automatically by all `ESTap`s down the flow:</p><pre class="programlisting prettyprint lang-java">Properties props = new Properties();
props.setProperty("es.index.auto.create", "false"); <a id="CO4-1"></a><span><img src="images/icons/callouts/1.png" alt="1" border="0" /></span>
...
FlowConnector flow = new HadoopFlowConnector(props);</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO4-1"><span><img src="images/icons/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
set elasticsearch-hadoop option
</p></td></tr></table></div><p>This approach can be used for local and remote/Hadoop flows - simply use the appropriate <code class="literal">FlowConnector</code>.</p><h3><a id="_type_conversion"></a>Type conversion</h3><p>Depending on the <a class="ulink" href="http://docs.cascading.org/cascading/2.1/userguide/htmlch03s04.html" target="_top">platform</a> used, Cascading can use internally either <code class="literal">Writable</code> or JDK types for its tuples. Elasticsearch handles both transparently
(see the Map/Reduce <a class="link" href="mapreduce.html#type-conversion-writable" title="Type conversion">conversion</a> section) though we recommend using the same types (if possible) in both cases to avoid the overhead of maintaining two different versions.</p><div class="important" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/icons/important.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>If automatic index creation is used, please review <a class="link" href="mapping.html#auto-mapping-type-loss">this</a> section for more information.</p></td></tr></table></div><h3><a id="cascading-writing"></a>Writing data to Elasticsearch</h3><p>Simply hook, <code class="literal">ESTap</code> into the Cascading flow:</p><pre class="programlisting prettyprint lang-java">Tap in = Lfs(new TextDelimited(new Fields("id", "name", "url", "picture")),
                                "src/test/resources/artists.dat");
Tap out = new ESTap("radio/artists" <a id="CO5-1"></a><span><img src="images/icons/callouts/1.png" alt="1" border="0" /></span>, new Fields("name", "url", "picture") <a id="CO5-2"></a><span><img src="images/icons/callouts/2.png" alt="2" border="0" /></span>);
new HadoopFlowConnector().connect(in, out, new Pipe("write-to-Eleasti")).complete();</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO5-1"><span><img src="images/icons/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
elasticsearch-hadoop resource (index and type)
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO5-2"><span><img src="images/icons/callouts/2.png" alt="2" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
Cascading tuple declaration
</p></td></tr></table></div><h3><a id="_reading_data_from_elasticsearch_2"></a>Reading data from Elasticsearch</h3><p>Just the same, add <code class="literal">ESTap</code> on the other end of a pipe, to read (instead of writing) to it.</p><pre class="programlisting prettyprint lang-java">Tap in = new ESTap("radio/artists/_search?q=me*" <a id="CO6-1"></a><span><img src="images/icons/callouts/1.png" alt="1" border="0" /></span>);
Tap out = new StdOut(new TextLine());
new LocalFlowConnector().connect(in, out, new Pipe("read-from-ES")).complete();</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO6-1"><span><img src="images/icons/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
elasticsearch-hadoop resource (index and type)
</p></td></tr></table></div></div><div class="navfooter"><span class="prev"><a href="mapreduce.html">
              « 
              Map/Reduce integration</a>
           
        </span><span class="next">
           
          <a href="hive.html">Apache Hive integration
               » 
            </a></span></div>
